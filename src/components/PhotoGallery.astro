<section class="w-full">
    <div id="justified-gallery" class="relative w-full h-[600px]"></div>
</section>

<script>
  import justifiedLayout from 'justified-layout';

  const images = [
      {
          id: 1,
          src: "https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?auto=format&fit=crop&w=800&q=80",
          thumbnail: "https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?auto=format&fit=crop&w=400&q=60",
          alt: "Mountain landscape",
          width: 1200,
          height: 800,
          description: "A serene mountain vista with dramatic clouds and sunlight breaking through."
      },
      {
          id: 2,
          src: "https://images.unsplash.com/photo-1471922694854-ff1b63b20054?auto=format&fit=crop&w=800&q=80",
          thumbnail: "https://images.unsplash.com/photo-1471922694854-ff1b63b20054?auto=format&fit=crop&w=400&q=60",
          alt: "Ocean view",
          width: 800,
          height: 1200,
          description: "Calm ocean waves with soft light illuminating the horizon at sunset."
      },
      {
          id: 3,
          src: "https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?auto=format&fit=crop&w=800&q=80",
          thumbnail: "https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?auto=format&fit=crop&w=400&q=60",
          alt: "City skyline",
          width: 1200,
          height: 900,
          description: "Urban cityscape with tall skyscrapers reflecting golden hour light."
      },
      {
          id: 4,
          src: "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?auto=format&fit=crop&w=800&q=80",
          thumbnail: "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?auto=format&fit=crop&w=400&q=60",
          alt: "Forest path",
          width: 900,
          height: 1300,
          description: "Sunlight filtering through dense forest canopy creating a mystical atmosphere."
      },
      {
          id: 5,
          src: "https://images.unsplash.com/photo-1470770841072-f978cf4d019e?auto=format&fit=crop&w=800&q=80",
          thumbnail: "https://images.unsplash.com/photo-1470770841072-f978cf4d019e?auto=format&fit=crop&w=400&q=60",
          alt: "Desert scene",
          width: 1300,
          height: 900,
          description: "Vast desert landscape with dramatic rock formations and distant mountains."
      },
      {
          id: 6,
          src: "https://images.unsplash.com/photo-1436891620584-47fd0e565afb?auto=format&fit=crop&w=800&q=80",
          thumbnail: "https://images.unsplash.com/photo-1436891620584-47fd0e565afb?auto=format&fit=crop&w=400&q=60",
          alt: "Waterfall",
          width: 800,
          height: 1100,
          description: "Powerful waterfall cascading down moss-covered rocks in a lush green setting."
      },
      {
          id: 7,
          src: "https://images.unsplash.com/photo-1418065460487-3e41a6c84dc5?auto=format&fit=crop&w=800&q=80",
          thumbnail: "https://images.unsplash.com/photo-1418065460487-3e41a6c84dc5?auto=format&fit=crop&w=400&q=60",
          alt: "Autumn trees",
          width: 1200,
          height: 700,
          description: "Vibrant autumn foliage creating a tapestry of red and gold colors."
      },
      {
          id: 8,
          src: "https://images.unsplash.com/photo-1454496522488-7a8e488e8606?auto=format&fit=crop&w=800&q=80",
          thumbnail: "https://images.unsplash.com/photo-1454496522488-7a8e488e8606?auto=format&fit=crop&w=400&q=60",
          alt: "Snowy peaks",
          width: 900,
          height: 1200,
          description: "Majestic snow-capped mountain peaks reaching into a clear blue sky."
      },
      {
          id: 9,
          src: "https://images.unsplash.com/photo-1505144808419-1957a94ca61e?auto=format&fit=crop&w=800&q=80",
          thumbnail: "https://images.unsplash.com/photo-1505144808419-1957a94ca61e?auto=format&fit=crop&w=400&q=60",
          alt: "Tropical beach",
          width: 1300,
          height: 800,
          description: "Pristine tropical beach with crystal clear waters and swaying palm trees."
      }

  ];

  function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  }

  function updateGalleryLayout() {
    const container = document.getElementById("justified-gallery");
    if (!container) return;

    const layout = justifiedLayout(images.map(img => ({
      width: img.width,
      height: img.height
    })), {
      containerWidth: container.clientWidth,
      targetRowHeight: Math.max(150, Math.min(container.clientWidth * 0.2, 250)), // Responsive row height
      boxSpacing: Math.min(10, Math.max(5, container.clientWidth * 0.01)), // Responsive spacing
    });

    container.style.height = layout.containerHeight + 'px';

    container.innerHTML = layout.boxes.map((box, i) => `
      <a href="${images[i].src}"
         class="glightbox absolute transition-transform hover:scale-[1.02] hover:z-10"
         style="top: ${box.top}px; left: ${box.left}px; width: ${box.width}px; height: ${box.height}px;">
        <img src="${images[i].src}"
             loading="lazy"
             class="w-full h-full object-cover rounded-sm shadow-sm hover:shadow-lg transition-shadow"
             alt="${images[i].alt}" />
      </a>
    `).join("");
  }

  // Initial layout
  window.addEventListener("DOMContentLoaded", updateGalleryLayout);

  // Update layout on resize with debouncing
  window.addEventListener("resize", debounce(updateGalleryLayout, 250));

  // Update layout when the container becomes visible (if using tabs or dynamic content)
  if (typeof IntersectionObserver !== 'undefined') {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          updateGalleryLayout();
        }
      });
    });

    const container = document.getElementById("justified-gallery");
    if (container) {
      observer.observe(container);
    }
  }
</script>
